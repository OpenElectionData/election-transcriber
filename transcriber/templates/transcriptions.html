{% extends 'base.html' %}
{% from 'macros.html' import render_image, render_admin_header %}
{% block title %}{{task.name}}{% endblock %}
{% block content %}

{{ render_admin_header(task.name, task, task.id, 'transcriptions', current_user) }}

<div class="row">
    <div class="col-sm-6">
        <p class="status-heading"><strong>Progress Overview</strong></p>
        <div class="progress">
            <div class="progress-bar progress-bar-done progress-tooltip" role="progressbar" aria-valuenow="{{task['progress']['docs_done_perc']}}" aria-valuemin="0" aria-valuemax="100" title="" data-content="content here" data-placement="bottom" data-toggle="tooltip" data-original-title="images completed" style="width: {{task['progress']['docs_done_perc']}}%">
            </div>
            <div class="progress-bar progress-bar-inprog progress-tooltip" role="progressbar" aria-valuenow="{{task['progress']['docs_inprog_perc']}}" aria-valuemin="0" aria-valuemax="100" title="" data-content="content here" data-placement="bottom" data-toggle="tooltip" data-original-title="images in progress" style="width: {{task['progress']['docs_inprog_perc']}}%">
            </div>
            <div class="progress-bar progress-bar-conflict progress-tooltip" role="progressbar" aria-valuenow="{{task['progress']['docs_conflict_perc']}}" aria-valuemin="0" aria-valuemax="100" title="" data-content="content here" data-placement="bottom" data-toggle="tooltip" data-original-title="images with conflicting transcriptions" style="width: {{task['progress']['docs_conflict_perc']}}%">
            </div>
        </div>
    </div>
    <div class="col-sm-3">
        <p class="status-heading">
            task is <strong>{{task['progress']['reviews_done_perc']}}%</strong> complete
        </p>
        <p>
            {{task.image_count}} images<br>
            {{task.reviewer_count}} reviewers each<br>
        </p>
    </div>
    <div class="col-sm-3">
        <div class="well well-sm">
            <p><strong>Image Source</strong></p>
            <p>
                Project: {{task.dc_project}}<br>
                {% if task.dc_filter %}
                    {% if task.dc_filter|length == 1%}
                        1 Filter: {{task.dc_filter[0]}}
                    {% elif task.dc_filter|length > 1 %}
                        {{task.dc_filter|length}} Filters
                        <small><ul>
                            {% for filter in task.dc_filter %}
                            <li>{{filter}}</li>
                            {% endfor %}
                        </ul></small>
                    {% endif %}
                {% endif %}
            </p>
        </div>
    </div>
</div>
<hr>

<div class="row">
    <div class="col-sm-12">
        {% if transcriptions_final %}
            <p class="status-heading">
                <i class="fa fa-pencil fa-fw done"></i>
                <strong>{{transcriptions_final|length - 1}}</strong> images fully transcribed
            </p>
            <a href="{{ url_for('views.download_transcriptions', task_id=task.id) }}" class="btn btn-default pull-right"><i class="fa fa-download fa-fw"></i> Download CSV</a>
            <div>
                <i class="fa fa-times fa-fw"></i> Blank &nbsp;&nbsp;&nbsp;
                <i class="fa fa-question fa-fw"></i> Not legible &nbsp;&nbsp;&nbsp;
                <i class="fa fa-exclamation-triangle fa-fw"></i> Looks altered <br>
            </div>
            <table class="table" id="final_transcriptions">
                <thead>
                    <tr>
                        {% for h in transcriptions_final[0] %}
                            <th> {{h}} </th>
                        {% endfor %}
                    </tr>
                </thead>
                <tbody>
                {% for transcription in transcriptions_final[1:] %}
                    <tr>
                        {% for col in transcription %}
                            <td><small> {{col|safe}} </small></td>
                        {% endfor %}
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p class="status-heading"><i class="fa fa-pencil fa-fw done"></i> No fully transcribed images yet</p>
        {% endif %}
    </div>
</div>

{% if images_inprog %}
<div class="row">
    <div class="col-sm-12">
        <hr>
        <p class="status-heading">
            <i class="fa fa-pencil fa-fw inprog"></i>
            <strong>{{images_inprog|length}}</strong> images partially transcribed
        </p>
        {% for image in images_inprog %}
            <div class="image_ids small"><a href="{{image.fetch_url}}" target="_blank"> {{image.id}} </a></div>
        {% endfor %}
    </div>
</div>
{% endif %}

{% if images_conflict %}
<div class="row">
    <div class="col-sm-12">
        <hr>
        <p class="status-heading">
            <i class="fa fa-pencil fa-fw conflict"></i>
            <strong>{{images_conflict|length}}</strong> images with conflicting transcriptions
        </p>
        {% for image in images_conflict %}
            <div class="image_ids small"><a href="{{image.fetch_url}}" target="_blank"> {{image.id}} </a></div>
        {% endfor %}
    </div>
</div>
{% endif %}

{% if images_unseen %}
<div class="row">
    <div class="col-sm-12">
        <hr>
        <p class="status-heading">
            <i class="fa fa-pencil fa-fw unseen"></i>
            <strong>{{images_unseen|length}}</strong> images without any transcriptions yet
        </p>
        {% for image in images_unseen %}
            <div class="image_ids small"><a href="{{image.fetch_url}}" target="_blank"> {{image.id}} </a></div>
        {% endfor %}
    </div>
</div>
{% endif %}


{% endblock %}
{% block extra_javascript %}
    <script src="{{ url_for('static', filename='js/jquery.dataTables.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/jquery.dataTables.sorting.js') }}"></script>
    <script type="text/javascript">
        $(document).ready(function(){
            $('tr th:nth-child(1)').css('color', '#aaa');
            $('tr th:nth-child(2)').css('color', '#aaa');
            $('tr th:nth-child(3)').css('color', '#aaa');
            $('tr th:nth-child(4)').css('color', '#aaa');
            $('tr th:nth-child(5)').css('color', '#aaa');
            $('tr td:nth-child(2)').css('color', '#aaa');
            $('tr td:nth-child(3)').css('color', '#aaa');
            $('tr td:nth-child(4)').css('color', '#aaa');
            $('tr td:nth-child(5)').css('color', '#aaa');
            $('td >> .fa-question').parent().parent().css('background-color','#fcebca');
            $('td >> .fa-times').parent().parent().css('background-color','#f9da9a');
            $('td >> .fa-exclamation-triangle').parent().parent().css('background-color','#fab0a7');
            $('.progress-tooltip').tooltip();

            $('#final_transcriptions').DataTable( {
                "aaSorting": [ [0,'asc'] ],
                "paging": false,
                "searching": false,
                "info": false
            } );
        })

    </script>
{% endblock %}
