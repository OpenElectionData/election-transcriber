{% extends 'base.html' %}
{% from 'macros.html' import render_image, render_admin_header %}
{% block title %}{{task.name}}{% endblock %}
{% block content %}

{{ render_admin_header(task.name, task, task.id, 'transcriptions') }}

<div class="row">
    <div class="col-sm-6">
        <div class="well">
            <h3>Progress Overview</h3>
            <div class="progress">
                <div class="progress-bar progress-bar-success progress-tooltip" role="progressbar" aria-valuenow="{{task['progress']['docs_done_perc']}}" aria-valuemin="0" aria-valuemax="100" title="" data-content="content here" data-placement="bottom" data-toggle="tooltip" data-original-title="images completed" style="width: {{task['progress']['docs_done_perc']}}%">
                </div>
                <div class="progress-bar progress-bar-info progress-tooltip" role="progressbar" aria-valuenow="{{task['progress']['docs_inprog_perc']}}" aria-valuemin="0" aria-valuemax="100" title="" data-content="content here" data-placement="bottom" data-toggle="tooltip" data-original-title="images in progress" style="width: {{task['progress']['docs_inprog_perc']}}%">
                </div>
                <div class="progress-bar progress-bar-warning progress-tooltip" role="progressbar" aria-valuenow="{{task['progress']['docs_conflict_perc']}}" aria-valuemin="0" aria-valuemax="100" title="" data-content="content here" data-placement="bottom" data-toggle="tooltip" data-original-title="images with conflicting transcriptions" style="width: {{task['progress']['docs_conflict_perc']}}%">
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-sm-12">
        {% if transcriptions_final %}
            <h3><strong>{{transcriptions_final|length - 1}}</strong> images fully transcribed</h3>
            <a href="{{ url_for('views.download_transcriptions', task_id=task.id) }}" class="btn btn-default pull-right"><i class="fa fa-download fa-fw"></i> Download CSV</a>
            <div>
                <i class="fa fa-times fa-fw"></i> Blank &nbsp;&nbsp;&nbsp;
                <i class="fa fa-question fa-fw"></i> Not legible &nbsp;&nbsp;&nbsp;
                <i class="fa fa-exclamation-triangle fa-fw"></i> Looks altered <br>
            </div>
            <table class="table">
                <tr>
                    {% for h in transcriptions_final[0] %}
                        <th> {{h}} </th>
                    {% endfor %}
                </tr>
                {% for transcription in transcriptions_final[1:] %}
                    <tr>
                        {% for col in transcription %}
                            <td><small> {{col|safe}} </small></td>
                        {% endfor %}
                    </tr>
                {% endfor %}
            </table>
        {% else %}
            <h2>No fully transcribed images yet</h2>
        {% endif %}
    </div>
</div>

{% if images_inprog %}
<div class="row">
    <div class="col-sm-12">
        <hr>
        <h3><strong>{{images_inprog|length}}</strong> images partially transcribed</h3>
        <strong>image_id list</strong><br>
        {% for image in images_inprog %}
            <div class="unseen-image small"><a href="{{image.fetch_url}}" target="_blank"> {{image.id}} </a></div>
        {% endfor %}
    </div>
</div>
{% endif %}

{% if images_unseen %}
<div class="row">
    <div class="col-sm-12">
        <hr>
        <h3><strong>{{images_unseen|length}}</strong> images without any transcriptions yet</h3>
        <strong>image_id list</strong><br>
        {% for image in images_unseen %}
            <div class="unseen-image small"><a href="{{image.fetch_url}}" target="_blank"> {{image.id}} </a></div>
        {% endfor %}
    </div>
</div>
{% endif %}


{% endblock %}
{% block extra_javascript %}

    <script type="text/javascript">
        $(document).ready(function(){
            $('tr td:nth-child(1)').css('background-color', '#eee');
            $('tr td:nth-child(2)').css('background-color', '#eee');
            $('tr td:nth-child(3)').css('background-color', '#eee');
            $('td >> .fa-question').parent().parent().css('background-color','#fcebca');
            $('td >> .fa-times').parent().parent().css('background-color','#f9da9a');
            $('td >> .fa-exclamation-triangle').parent().parent().css('background-color','#fab0a7');
            $('.progress-tooltip').tooltip();
        })

    </script>
{% endblock %}
