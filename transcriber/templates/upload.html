{% extends 'base.html' %}
{% block title %}Task Creator - Upload{% endblock %}
{% block content %}
<div class="row">
    <div class='col-sm-8'>
        <h3>Start a new transcription task</h3>
        <p>Specify the documents to be transcribed</p>
        <div class='well'>
          <form role="form" class="form" method="POST" action="" enctype="multipart/form-data">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
            <div class="form-group">
              <label for="project_name" class="control-label">Select a document cloud project</label>


              <select class="form-control" id="project_name" name="project_name">
                {% if not project_name %}
                <option disabled selected> -- </option>
                  {% for project_option in project_list %}
                  <option>{{project_option}}</option>
                  {% endfor %}
                {% else %}
                  <option>{{project_name}}</option>
                  {% for project_option in project_list %}
                    {% if project_option != project_name %}
                    <option>{{project_option}}</option>
                    {% endif %}
                  {% endfor %}
                {% endif %}
              </select>
              <span id="spinner"></span>
              {% if session.doc_url_list and not hierarchy_filter%}
                <span class="post-button-text">
                  <strong>{{ session.doc_url_list|length }}</strong> images found for {{ project_name }}
                </span><br>
              {% endif %}

              <br>
              {% if project_name %}
              <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
                <div class="panel panel-default">
                  <div class="panel-heading" role="tab" id="headingOne" data-toggle="collapse" data-parent="#accordion" href="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                    <h4 class="panel-title">
                        <i class="fa fa-plus"></i> Advanced Options
                    </h4>
                  </div>
                  {% if hierarchy_filter %}
                  <div id="collapseOne" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingOne">
                  {% else %}
                  <div id="collapseOne" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne">
                  {% endif %}
                    <div class="panel-body">
                      
                      <label for="hierarchy_filter" class="control-label">Filter documents by hierarchy</label>
                      <input type="text"
                         class="form-control"
                         id="hierarchy_filter"
                         name="hierarchy_filter"
                         placeholder="/ATLANTIDA/*"
                        {% if hierarchy_filter %}
                          value={{hierarchy_filter}}
                        {% endif %}
                         aria-describedby="section-name-addon"/>
                      <p><small>Enter a match pattern to filter documents based on the <code>hierarchy</code> data attribute in DocumentCloud</small></p>

                      <button id="filter-images-hierarchy" type="submit" class="btn btn-default btn-sm">Apply filters</button>
                      <span id="spinner-2">
                      </span>
                      {% if session.doc_url_list and hierarchy_filter %}
                        <span class="post-button-text-2">
                          <strong>{{ session.doc_url_list|length }}</strong> images found for {{ project_name }}
                        </span>
                      {% endif %}

                    </div>
                  </div>
                </div>
              </div>
              {% endif %}

            </div>

          </form>
        </div>
        {% if session.doc_url_list %}
          <a href="{{ url_for('views.form_creator') }}" class="btn btn-success" id="next-step">Create task with {{session.doc_url_list|length}} images ></a>
        {% endif %}
    </div>
</div>
{% endblock %}
{% block extra_javascript %}
  <script>
    $(document).ready(function(){
      $('#project_name').change(function() {
        $(".post-button-text").empty()
        $("#accordion").remove()
        $("#spinner").append('<i class="fa fa-circle-o-notch fa-lg fa-spin"></i> <small>searching DocumentCloud...</small>')
        this.form.submit();
      });

      $( "#filter-images-hierarchy" ).click(function() {
        $(".post-button-text").empty()
        $(".post-button-text-2").empty()
        $("#next-step").hide()
        $("#spinner-2").append('<i class="fa fa-circle-o-notch fa-lg fa-spin"></i> <small>searching DocumentCloud...</small>')
      });

    });
  </script>
{% endblock %}
